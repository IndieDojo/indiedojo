{"version":3,"sources":["../../../src/internal-plugins/query-runner/gatsby-node.js"],"names":["fs","require","path","watchComponent","pageComponents","exports","onCreatePage","page","store","boundActionCreators","component","pathToJSONFile","join","getState","program","directory","jsonName","existsSync","writeFile","createPageComponent"],"mappings":";;AAAA,IAAMA,KAAKC,aAAX;AACA,IAAMC,OAAOD,eAAb;;eAE2BA,0B;IAAnBE,c,YAAAA,c;;AAER,IAAIC,iBAAiB,EAArB;AACAC,QAAQC,YAAR,GAAuB,gBAA0C;AAAA,MAAvCC,IAAuC,QAAvCA,IAAuC;AAAA,MAAjCC,KAAiC,QAAjCA,KAAiC;AAAA,MAA1BC,mBAA0B,QAA1BA,mBAA0B;;AAC/D,MAAMC,YAAYH,KAAKG,SAAvB;AACA,MAAI,CAACN,eAAeM,SAAf,CAAL,EAAgC;AAC9B;AACA;AACA;AACA;AACA,QAAMC,iBAAiBT,KAAKU,IAAL,CACrBJ,MAAMK,QAAN,GAAiBC,OAAjB,CAAyBC,SADJ,oBAIrBR,KAAKS,QAJgB,CAAvB;AAMA,QAAI,CAAChB,GAAGiB,UAAH,CAAcN,cAAd,CAAL,EAAoC;AAClCX,SAAGkB,SAAH,CAAaP,cAAb,QAAmC,YAAM,CAAE,CAA3C;AACD;AACDF,wBAAoBU,mBAApB,CAAwCT;;AAExC;AAFA,MAGAP,eAAeO,SAAf;AACD;;AAED;AACAN,iBAAeM,SAAf,IAA4BA,SAA5B;AACD,CAxBD","file":"gatsby-node.js","sourcesContent":["const fs = require(`fs`)\nconst path = require(`path`)\n\nconst { watchComponent } = require(`./query-watcher`)\n\nlet pageComponents = {}\nexports.onCreatePage = ({ page, store, boundActionCreators }) => {\n  const component = page.component\n  if (!pageComponents[component]) {\n    // We haven't seen this component before so we:\n    // - Ensure it has a JSON file.\n    // - Add it to Redux\n    // - Watch the component to detect query changes\n    const pathToJSONFile = path.join(\n      store.getState().program.directory,\n      `.cache`,\n      `json`,\n      page.jsonName\n    )\n    if (!fs.existsSync(pathToJSONFile)) {\n      fs.writeFile(pathToJSONFile, `{}`, () => {})\n    }\n    boundActionCreators.createPageComponent(component)\n\n    // Make sure we're watching this component.\n    watchComponent(component)\n  }\n\n  // Mark we've seen this page component.\n  pageComponents[component] = component\n}\n"]}