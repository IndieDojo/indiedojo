{"version":3,"sources":["../../../src/internal-plugins/query-runner/query-printer.js"],"names":["forEachObject","require","forEach","invariant","DEFAULT_HANDLE_KEY","GraphQLEnumType","GraphQLInputObjectType","GraphQLList","GraphQLNonNull","INDENT","print","node","kind","name","String","type","printFragmentArgumentDefinitions","argumentDefinitions","printDirectives","directives","printSelections","operation","printArgumentDefinitions","indent","parentCondition","selections","printed","map","printSelection","selection","join","length","str","alias","printArguments","args","printHandles","typeCondition","toString","printFragmentArguments","value","printValue","condition","condStr","passingValue","subSelections","sel","def","defaultValue","printLiteral","push","field","handles","key","handle","filters","sort","directive","printedArgs","printedValue","arg","variableName","pairs","fields","typeFields","getFields","innerValue","filter","Boolean","innerType","ofType","items","i","Array","isArray","itemType","item","val","module","exports"],"mappings":"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","file":"query-printer.js","sourcesContent":["/**\n * Copyright (c) 2013-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n *\n * @flow\n */\nconst forEachObject = require(`lodash`).forEach\nconst invariant = require(`invariant`)\n\nconst DEFAULT_HANDLE_KEY = ``\nconst {\n  GraphQLEnumType,\n  GraphQLInputObjectType,\n  GraphQLList,\n  GraphQLNonNull,\n} = require(`graphql`)\n\nimport type {\n  Argument,\n  ArgumentDefinition,\n  ArgumentValue,\n  Directive,\n  Field,\n  Fragment,\n  LocalArgumentDefinition,\n  Node,\n  Root,\n  Selection,\n} from \"relay-compiler/lib/RelayIR\"\nimport type { GraphQLInputType } from \"graphql\"\n\nconst INDENT = `  `\n\n/**\n * Converts a Relay IR node into a GraphQL string. Custom Relay\n * extensions (directives) are not supported; to print fragments with\n * variables or fragment spreads with arguments, transform the node\n * prior to printing.\n */\nfunction print(node: Root | Fragment): string {\n  if (node.kind === `Fragment`) {\n    return (\n      `fragment ${node.name} on ${String(node.type)}` +\n      printFragmentArgumentDefinitions(node.argumentDefinitions) +\n      printDirectives(node.directives) +\n      printSelections(node, ``) +\n      `\\n`\n    )\n  } else if (node.kind === `Root`) {\n    return (\n      `${node.operation} ${node.name}` +\n      printArgumentDefinitions(node.argumentDefinitions) +\n      printDirectives(node.directives) +\n      printSelections(node, ``) +\n      `\\n`\n    )\n  } else {\n    invariant(false, `RelayPrinter: Unsupported IR node \\`%s\\`.`, node.kind)\n  }\n}\n\nfunction printSelections(\n  node: Node,\n  indent: string,\n  parentCondition?: string\n): string {\n  const selections = node.selections\n  if (selections == null) {\n    return ``\n  }\n  const printed = selections.map(selection =>\n    printSelection(selection, indent, parentCondition)\n  )\n  let selection = printed.join(`\\n` + indent + INDENT)\n  return printed.length ? ` {\\n${indent + INDENT}${selection}\\n${indent}}` : ``\n}\n\nfunction printSelection(\n  selection: Selection,\n  indent: string,\n  parentCondition?: string\n): string {\n  parentCondition = parentCondition || ``\n  let str = ``\n  if (selection.kind === `LinkedField`) {\n    if (selection.alias != null) {\n      str += selection.alias + `: `\n    }\n    str += selection.name\n    str += printArguments(selection.args)\n    str += parentCondition\n    str += printDirectives(selection.directives)\n    str += printHandles(selection)\n    str += printSelections(selection, indent + INDENT)\n  } else if (selection.kind === `ScalarField`) {\n    if (selection.alias != null) {\n      str += selection.alias + `: `\n    }\n    str += selection.name\n    str += printArguments(selection.args)\n    str += parentCondition\n    str += printDirectives(selection.directives)\n    str += printHandles(selection)\n  } else if (selection.kind === `InlineFragment`) {\n    str += `... on ` + selection.typeCondition.toString()\n    str += parentCondition\n    str += printDirectives(selection.directives)\n    str += printSelections(selection, indent + INDENT)\n  } else if (selection.kind === `FragmentSpread`) {\n    str += `...` + selection.name\n    str += parentCondition\n    str += printFragmentArguments(selection.args)\n    str += printDirectives(selection.directives)\n  } else if (selection.kind === `Condition`) {\n    const value = printValue(selection.condition)\n    // For Flow\n    invariant(\n      value != null,\n      `RelayPrinter: Expected a variable for condition, got a literal \\`null\\`.`\n    )\n    let condStr = selection.passingValue ? ` @include` : ` @skip`\n    condStr += `(if: ` + value + `)`\n    condStr += parentCondition\n    // For multi-selection conditions, pushes the condition down to each\n    const subSelections = selection.selections.map(sel =>\n      printSelection(sel, indent, condStr)\n    )\n    str += subSelections.join(`\\n` + INDENT)\n  } else {\n    invariant(\n      false,\n      `RelayPrinter: Unknown selection kind \\`%s\\`.`,\n      selection.kind\n    )\n  }\n  return str\n}\n\nfunction printArgumentDefinitions(\n  argumentDefinitions: Array<LocalArgumentDefinition>\n): string {\n  const printed = argumentDefinitions.map(def => {\n    let str = `$${def.name}: ${def.type.toString()}`\n    if (def.defaultValue != null) {\n      str += ` = ` + printLiteral(def.defaultValue, def.type)\n    }\n    return str\n  })\n  return printed.length ? `(\\n${INDENT}${printed.join(`\\n` + INDENT)}\\n)` : ``\n}\n\nfunction printFragmentArgumentDefinitions(\n  argumentDefinitions: Array<ArgumentDefinition>\n): string {\n  let printed\n  argumentDefinitions.forEach(def => {\n    if (def.kind !== `LocalArgumentDefinition`) {\n      return\n    }\n    printed = printed || []\n    let str = `${def.name}: {type: \"${def.type.toString()}\"`\n    if (def.defaultValue != null) {\n      str += `, defaultValue: ${printLiteral(def.defaultValue, def.type)}`\n    }\n    str += `}`\n    printed.push(str)\n  })\n  return printed && printed.length\n    ? ` @argumentDefinitions(\\n${INDENT}${printed.join(`\\n` + INDENT)}\\n)`\n    : ``\n}\n\nfunction printHandles(field: Field): string {\n  if (!field.handles) {\n    return ``\n  }\n  const printed = field.handles.map(handle => {\n    // For backward compatibility and also because this module is\n    // shared by ComponentScript.\n    const key =\n      handle.key === DEFAULT_HANDLE_KEY ? `` : `, key: \"${handle.key}\"`\n    const filters =\n      handle.filters == null\n        ? ``\n        : `, filters: ${JSON.stringify(handle.filters.sort())}`\n    return `@__clientField(handle: \"${handle.name}\"${key}${filters})`\n  })\n  return printed.length ? ` ` + printed.join(` `) : ``\n}\n\nfunction printDirectives(directives: Array<Directive>): string {\n  const printed = directives.map(\n    directive => `@` + directive.name + printArguments(directive.args)\n  )\n  return printed.length ? ` ` + printed.join(` `) : ``\n}\n\nfunction printFragmentArguments(args: Array<Argument>) {\n  const printedArgs = printArguments(args)\n  if (!printedArgs.length) {\n    return ``\n  }\n  return ` @arguments${printedArgs}`\n}\n\nfunction printArguments(args: Array<Argument>): string {\n  const printed = []\n  args.forEach(arg => {\n    const printedValue = printValue(arg.value, arg.type)\n    if (printedValue != null) {\n      printed.push(arg.name + `: ` + printedValue)\n    }\n  })\n  return printed.length ? `(` + printed.join(`, `) + `)` : ``\n}\n\nfunction printValue(value: ArgumentValue, type: ?GraphQLInputType): ?string {\n  if (value.kind === `Variable`) {\n    return `$${value.variableName}`\n  } else if (value.kind === `ObjectValue`) {\n    invariant(\n      type instanceof GraphQLInputObjectType,\n      `RelayPrinter: Need an InputObject type to print objects.`\n    )\n    const pairs = value.fields\n      .map(field => {\n        const typeFields = type.getFields()\n        const innerValue = printValue(field.value, typeFields[field.name].type)\n        return innerValue == null ? null : field.name + `: ` + innerValue\n      })\n      .filter(Boolean)\n\n    return `{${pairs.join(`, `)}}`\n  } else if (value.kind === `ListValue`) {\n    invariant(\n      type instanceof GraphQLList,\n      `RelayPrinter: Need a type in order to print arrays.`\n    )\n    const innerType = type.ofType\n    return `[${value.items.map(i => printValue(i, innerType)).join(`, `)}]`\n  } else if (value.value != null) {\n    return printLiteral(value.value, type)\n  } else {\n    return null\n  }\n}\n\nfunction printLiteral(value: mixed, type: ?GraphQLInputType): string {\n  if (type instanceof GraphQLNonNull) {\n    type = type.ofType\n  }\n  if (type instanceof GraphQLEnumType) {\n    invariant(\n      typeof value === `string`,\n      `RelayPrinter: Expected value of type %s to be a string, got \\`%s\\`.`,\n      type.name,\n      value\n    )\n    return value\n  }\n  if (Array.isArray(value)) {\n    invariant(\n      type instanceof GraphQLList,\n      `RelayPrinter: Need a type in order to print arrays.`\n    )\n    const itemType = type.ofType\n    return (\n      `[` + value.map(item => printLiteral(item, itemType)).join(`, `) + `]`\n    )\n  } else if (typeof value === `object` && value) {\n    const fields = []\n    invariant(\n      type instanceof GraphQLInputObjectType,\n      `RelayPrinter: Need an InputObject type to print objects.`\n    )\n    const typeFields = type.getFields()\n    forEachObject(value, (val, key) => {\n      fields.push(key + `: ` + printLiteral(val, typeFields[key].type))\n    })\n    return `{` + fields.join(`, `) + `}`\n  } else {\n    return JSON.stringify(value)\n  }\n}\n\nmodule.exports = { print }\n"]}