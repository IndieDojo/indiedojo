{"version":3,"sources":["../../../src/redux/actions/add-page-dependency.js"],"names":["_","require","store","actions","exports","createPageDependency","path","nodeId","connection","state","getState","nodeDependencyExists","connectionDependencyExists","includes","pageDataDependencies","nodes","connections","action","dispatch"],"mappings":";;AAAA,IAAMA,IAAIC,iBAAV;;eAEkBA,c;IAAVC,K,YAAAA,K;;gBACYD,wB;IAAZE,O,aAAAA,O;;AAERC,QAAQC,oBAAR,GAA+B,gBAAkC;AAAA,MAA/BC,IAA+B,QAA/BA,IAA+B;AAAA,MAAzBC,MAAyB,QAAzBA,MAAyB;AAAA,MAAjBC,UAAiB,QAAjBA,UAAiB;;AAC/D,MAAMC,QAAQP,MAAMQ;;AAEpB;AACA;AAHc,IAAd,CAIA,IAAIC,uBAAuB,KAA3B;AACA,MAAIC,6BAA6B,KAAjC;AACA,MAAI,CAACL,MAAL,EAAa;AACXI,2BAAuB,IAAvB;AACD;AACD,MAAIJ,UAAUP,EAAEa,QAAF,CAAWJ,MAAMK,oBAAN,CAA2BC,KAA3B,CAAiCR,MAAjC,CAAX,EAAqDD,IAArD,CAAd,EAA0E;AACxEK,2BAAuB,IAAvB;AACD;AACD,MAAI,CAACH,UAAL,EAAiB;AACfI,iCAA6B,IAA7B;AACD;AACD,MACEJ,cACAR,EAAEa,QAAF,CAAWJ,MAAMK,oBAAN,CAA2BE,WAAtC,EAAmDR,UAAnD,CAFF,EAGE;AACAI,iCAA6B,IAA7B;AACD;AACD,MAAID,wBAAwBC,0BAA5B,EAAwD;AACtD,WAAO,KAAP;AACD;;AAED;AACA,MAAMK,SAASd,QAAQE,oBAAR,CAA6B,EAAEC,UAAF,EAAQC,cAAR,EAAgBC,sBAAhB,EAA7B,CAAf;AACAN,QAAMgB,QAAN,CAAeD,MAAf;AACD,CA7BD","file":"add-page-dependency.js","sourcesContent":["const _ = require(`lodash`)\n\nconst { store } = require(`../`)\nconst { actions } = require(`../actions.js`)\n\nexports.createPageDependency = ({ path, nodeId, connection }) => {\n  const state = store.getState()\n\n  // Check that the dependencies aren't already recorded so we\n  // can avoid creating lots of very noisy actions.\n  let nodeDependencyExists = false\n  let connectionDependencyExists = false\n  if (!nodeId) {\n    nodeDependencyExists = true\n  }\n  if (nodeId && _.includes(state.pageDataDependencies.nodes[nodeId], path)) {\n    nodeDependencyExists = true\n  }\n  if (!connection) {\n    connectionDependencyExists = true\n  }\n  if (\n    connection &&\n    _.includes(state.pageDataDependencies.connections, connection)\n  ) {\n    connectionDependencyExists = true\n  }\n  if (nodeDependencyExists && connectionDependencyExists) {\n    return false\n  }\n\n  // It's new, let's dispatch it\n  const action = actions.createPageDependency({ path, nodeId, connection })\n  store.dispatch(action)\n}\n"]}