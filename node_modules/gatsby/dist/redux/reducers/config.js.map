{"version":3,"sources":["../../../src/redux/reducers/config.js"],"names":["Joi","require","chalk","_","gatsbyConfigSchema","module","exports","state","action","type","result","validate","payload","error","console","log","blue","bgYellow","bold","red","linkPrefix","Error","pathPrefix","startsWith","endsWith","slice"],"mappings":";;;;;;;;AAAA,IAAMA,MAAMC,cAAZ;AACA,IAAMC,QAAQD,gBAAd;AACA,IAAME,IAAIF,iBAAV;;eAE+BA,gC;IAAvBG,kB,YAAAA,kB;;AAERC,OAAOC,OAAP,GAAiB,YAAwB;AAAA,MAAvBC,KAAuB,uEAAf,EAAe;AAAA,MAAXC,MAAW;;AACvC,UAAQA,OAAOC,IAAf;AACE;AACE;AACA,UAAMC,SAASV,IAAIW,QAAJ,CAAaH,OAAOI,OAApB,EAA6BR;AAC5C;AACA;AACA;AAHe,OAAf,CAIA,IAAIM,OAAOG,KAAX,EAAkB;AAChBC,gBAAQC,GAAR,CACEb,MAAMc,IAAN,CAAWC,QAAX,iDADF;AAGAH,gBAAQC,GAAR,CAAYb,MAAMgB,IAAN,CAAWC,GAAX,CAAeT,OAAOG,KAAtB,CAAZ;AACA,YAAIL,OAAOI,OAAP,CAAeQ,UAAnB,EAA+B;AAC7BN,kBAAQC,GAAR;AACD;AACD,cAAM,IAAIM,KAAJ,iDAAN;AACD;;AAED;AACA;AACA,UAAIb,OAAOI,OAAP,IAAkBJ,OAAOI,OAAP,CAAeU,UAArC,EAAiD;AAC/C,YAAI,CAACnB,EAAEoB,UAAF,CAAaf,OAAOI,OAAP,CAAeU,UAA5B,MAAL,EAAmD;AACjDd,iBAAOI,OAAP,CAAeU,UAAf,SAAgCd,OAAOI,OAAP,CAAeU,UAA/C;AACD;AACD,YAAInB,EAAEqB,QAAF,CAAWhB,OAAOI,OAAP,CAAeU,UAA1B,MAAJ,EAAgD;AAC9Cd,iBAAOI,OAAP,CAAeU,UAAf,GAA4Bd,OAAOI,OAAP,CAAeU,UAAf,CAA0BG,KAA1B,CAAgC,CAAhC,EAAmC,CAAC,CAApC,CAA5B;AACD;AACF;;AAED,wCACKjB,OAAOI,OADZ;AAGF;AACE,aAAOL,KAAP;AAjCJ;AAmCD,CApCD","file":"config.js","sourcesContent":["const Joi = require(`joi`)\nconst chalk = require(`chalk`)\nconst _ = require(`lodash`)\n\nconst { gatsbyConfigSchema } = require(`../../joi-schemas/joi`)\n\nmodule.exports = (state = {}, action) => {\n  switch (action.type) {\n    case `SET_SITE_CONFIG`:\n      // Validate the config.\n      const result = Joi.validate(action.payload, gatsbyConfigSchema)\n      // TODO use Redux for capturing errors from different\n      // parts of Gatsby so a) can capture richer errors and b) be\n      // more flexible how to display them.\n      if (result.error) {\n        console.log(\n          chalk.blue.bgYellow(`The site's gatsby-config.js failed validation`)\n        )\n        console.log(chalk.bold.red(result.error))\n        if (action.payload.linkPrefix) {\n          console.log(`\"linkPrefix\" should be changed to \"pathPrefix\"`)\n        }\n        throw new Error(`The site's gatsby-config.js failed validation`)\n      }\n\n      // Ensure that the pathPrefix (if set) starts with a forward slash\n      // and doesn't end with a slash.\n      if (action.payload && action.payload.pathPrefix) {\n        if (!_.startsWith(action.payload.pathPrefix, `/`)) {\n          action.payload.pathPrefix = `/${action.payload.pathPrefix}`\n        }\n        if (_.endsWith(action.payload.pathPrefix, `/`)) {\n          action.payload.pathPrefix = action.payload.pathPrefix.slice(0, -1)\n        }\n      }\n\n      return {\n        ...action.payload,\n      }\n    default:\n      return state\n  }\n}\n"]}